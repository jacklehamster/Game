function clearCanvas(){ctx.clearRect(0,0,canvas.width,canvas.height),makeBackground()}function nextScene(){loop=nop,preNext(),preNext=nop,sceneIndex=Math.min(scenes.length-1,sceneIndex+1),scenes[sceneIndex]()}function loadGame(savedState){loop=nop,preNext(),preNext=nop,state=savedState,sceneIndex=scenes.indexOf(loadGameFunction),loadGameFunction(!0)}function startOver(){state.name="",state.slots=[],loop=nop,preNext(),preNext=nop,sceneIndex=0,scenes[sceneIndex]()}function makeBox(){for(var i=0;i<4;i++)box[i]+=(arguments[i]-box[i])/8}function makeHero(){for(var i=0;i<4;i++)hero[i+5]+=(arguments[i]-hero[i+5])/8}function makeText(text,start){var size=Math.floor((time-start)/100);return text.slice(0,Math.max(0,Math.min(size,text.length)))}function enterText(text,start){return text+(time>start&&(time-start)%1200<900?"_":"")}function saveState(id,state){localStorage.setItem(id,JSON.stringify({name:state.name,slots:state.slots.map(function(img){return img.src})}))}function loadState(id){var state=JSON.parse(localStorage.getItem(id));return state&&(state.slots=state.slots.map(function(url){var img=new Image;return img.src=url,img.style.borderRadius="50%",img})),state}function makeBackground(){started||0!==sceneIndex?(ctx.drawImage(back,0,0),ctx.fillStyle="#555566"):(ctx.fillStyle=started||sceneIndex>0?grd:"#000000",ctx.fillRect(0,0,canvas.width,canvas.height),ctx.fillStyle="#000000")}function looper(t){DOK.time=time=t,loop(),requestAnimationFrame(looper)}function getGif(src){function makeCanvas(gif,index,width,height){var canvas=document.createElement("canvas");canvas.width=width,canvas.height=height,canvas.src=src;var ctx=canvas.getContext("2d");gif.putOnCanvas(ctx,0,0,width,height,0,0,width,height,index,function(){canvases[index]=canvas})}var gif=DOK.createGif(src),canvases=[];return gif.addEventListener("load",function(e){for(var width=gif.naturalWidth,height=gif.naturalHeight,i=0;i<gif.frameCount;i++)makeCanvas(gif,i,width,height)}),gif.canvases=canvases,gif}var canvas=document.getElementsByTagName("canvas")[0],ctx=canvas.getContext("2d"),time=0,nop=function(){},loop=nop,preNext=nop,loadGameFunction,skip=location.search.indexOf("skip")>0,sounds={collect:new Audio("media/collect.ogg"),hit:new Audio("media/hit.ogg"),jump:new Audio("media/jump.ogg"),shoot:new Audio("media/shoot.ogg")},state={name:"",slots:[]},grd=ctx.createRadialGradient(canvas.width/2-50,canvas.height/2+20,20,canvas.width/2+50,canvas.height/2-20,300);grd.addColorStop(0,"#FFFFFF"),grd.addColorStop(1,"#EEFEFE");var back=document.createElement("canvas");back.width=canvas.width,back.height=canvas.height,back.getContext("2d").fillStyle=grd,back.getContext("2d").fillRect(0,0,back.width,back.height);var errorMessage=null,started=!1,hero=[null,0,0,0,0,0,0,0,0],box=[canvas.width/2,canvas.height/2,1,1],sceneIndex=0,scenes=[function(){function cancel(e){return e=e||event,e.preventDefault(),!1}var start=time+1e3,error=0;loop=function(){if(started=time>=start,clearCanvas(),ctx.font="30px Comic",ctx.fillText(makeText("Welcome... what is your name?",start),260,150),time-start>4e3){var shake=error?Math.max(0,(300+error-time)/3):0;0===shake&&(error=0),makeBox(200+(Math.random()-.5)*shake,200+(Math.random()-.5)*shake,500,80)}else makeBox(0,0,canvas.width,canvas.height),started||(ctx.fillStyle=grd,ctx.fillRect.apply(ctx,box));ctx.strokeRect.apply(ctx,box),ctx.font="60px Comic",ctx.fillText(enterText(state.name,start+4500),250,260)};var f;document.addEventListener("keydown",f=function(e){if(e=e||event,13===e.keyCode)if("SKIP"===state.name){var savedState=loadState("game");savedState?loadGame(savedState):state.name=""}else state.name.length?nextScene():error=time;else if(8===e.keyCode)state.name=state.name.slice(0,state.name.length-1);else{var key=e.key||String.fromCharCode("0x"+e.keyIdentifier.split("U+")[1]);state.name+=key.toUpperCase()," "===state.name&&(state.name=""),state.name.length>10&&(state.name=state.name.slice(1))}e.preventDefault()}),document.addEventListener("dragover",cancel),document.addEventListener("dragenter",cancel),document.addEventListener("dragleave",cancel),document.addEventListener("drop",cancel),preNext=function(){document.removeEventListener("keydown",f),document.removeEventListener("dragover",cancel),document.removeEventListener("dragenter",cancel),document.removeEventListener("dragleave",cancel),document.removeEventListener("drop",cancel)}},promptImage=function(){function cancel(e){return e=e||event,"dragenter"==e.type?dragOver=1:"dragleave"==e.type&&(dragOver=0),e.preventDefault(),!1}var start=time,message=[null,["Hello "+state.name+". May I see you?","Please drop a picture in the box below.","The picture doesn't have to be you, it can be your avatar.","Transparent backgrounds and animated gif are ok. Square images are best."],["You look great "+state.name+"! Let's keep going.","What do you like? Please drop a picture below","Good example of pictures to drop are:","hearts, flowers, happy face, bubbles, puppies, rainbows..."],["How about something you dislike?","Can you drop that picture below?","Good example of pictures are: skulls, vampire bats,","space alien, trolls, a witch on a broom, a photo of Donald Trump..."],["Finally, can you drop one more picture?","Just choose something random.","Like: pizza, wet socks, fish, a car, beer bottle,","cheese, your underwear, an iPhone, a photo of Donald Trump..."]],dropped=0,mx=0,my=0,img=new Image;state.slots[sceneIndex-1]=img,img.style.borderRadius="50%";var dragOver=0;img.addEventListener("load",function(e){hero[5]=mx-img.naturalWidth/2,hero[6]=my-img.naturalHeight/2,hero[7]=img.naturalWidth,hero[8]=img.naturalHeight}),hero[0]=img,loop=function(){clearCanvas(),ctx.font="25px Comic",ctx.fillText(makeText(message[sceneIndex][0],start),290,30),ctx.fillText(makeText(message[sceneIndex][1],start+4500),255,60),ctx.fillText(makeText(message[sceneIndex][2],start+9e3),150,405),ctx.fillText(makeText(message[sceneIndex][3],start+15e3),150,435);var max=Math.max(img.naturalWidth,img.naturalHeight);dropped&&time-dropped>600&&img.naturalWidth?makeBox(400,175,100*img.naturalWidth/max,100*img.naturalHeight/max):makeBox(300+dragOver*Math.sin(time/30)*20,75+dragOver*Math.sin(time/30)*20,300-2*dragOver*Math.sin(time/30)*20,300-2*dragOver*Math.sin(time/30)*20),ctx.strokeRect.apply(ctx,box.map(Math.round)),hero[3]=img.naturalWidth,hero[4]=img.naturalHeight,makeHero(400,175,100*img.naturalWidth/max,100*img.naturalHeight/max),ctx.drawImage.apply(ctx,hero),dropped&&time-dropped>1e3&&nextScene()},preNext=function(){document.removeEventListener("dragover",cancel),document.removeEventListener("dragenter",cancel),document.removeEventListener("dragleave",cancel),document.removeEventListener("drop",f)};var f;document.addEventListener("dragover",cancel),document.addEventListener("dragenter",cancel),document.addEventListener("dragleave",cancel),document.addEventListener("drop",f=function(e){e=e||event,dropped=time,dragOver=0,e.preventDefault&&e.preventDefault(),mx=e.pageX,my=e.pageY;var dt=e.dataTransfer,files=(dt.items,dt.files),file=files[0],reader=new FileReader;return reader.addEventListener("loadend",function(e){if(!("image/gif"!=file.type&&"image/jpeg"!=file.type&&"image/png"!=file.type||file.size>1e7)){this.result;img.src=this.result,reader=null}}),reader.readAsDataURL(file),!1})},promptImage,promptImage,promptImage,function(){function cancel(e){return e=e||event,e.preventDefault(),!1}var start=time;makeBox(0,0,canvas.width,canvas.height),document.addEventListener("dragover",cancel),document.addEventListener("dragenter",cancel),document.addEventListener("dragleave",cancel),document.addEventListener("drop",cancel),loop=function(){clearCanvas(),ctx.font="30px Comic",ctx.fillText(makeText("Let's go over this again shall we?",start),260,100),ctx.fillText(makeText("        is what "+state.name+" looks like.",start+4e3),260,150),ctx.fillText(makeText("        is something "+state.name+" is fond of.",start+8e3),260,200),ctx.fillText(makeText(".. not so much ",start+13e3),260,250),ctx.fillText(makeText("About            ... let's just say it got thrown in there.",start+17e3),260,300),ctx.fillText(makeText("Are you happy with your choices?",start+26e3),260,350),ctx.fillText(makeText("Press the  space bar  for YES, esc for NO.",start+31e3),260,400);for(var i=0;i<state.slots.length;i++)if(time-start>timings[i]){var scale=50/state.slots[i].naturalHeight;ctx.drawImage(state.slots[i],0,0,state.slots[i].naturalWidth,state.slots[i].naturalHeight,locations[i][0],locations[i][1],state.slots[i].naturalWidth*scale,state.slots[i].naturalHeight*scale)}time-start>33e3&&(makeBox(locations[4][0]+8*Math.sin(time/50),locations[4][1]+8*Math.sin(time/50),locations[4][2]+-2*Math.sin(time/50)*8,locations[4][3]+-2*Math.sin(time/50)*8),ctx.strokeRect.apply(ctx,box.map(Math.round)))};var f;document.addEventListener("keydown",f=function(e){e=e||event,(time-start>33e3||skip)&&(32===e.keyCode?nextScene():27===e.keyCode&&startOver()),e.preventDefault()}),preNext=function(){document.removeEventListener("keydown",f),document.removeEventListener("dragover",cancel),document.removeEventListener("dragenter",cancel),document.removeEventListener("dragleave",cancel),document.removeEventListener("drop",cancel)}},loadGameFunction=function(loading){loading?loop=function(){clearCanvas(),state.slots.every(function(slot){return slot.getW()})&&nextScene()}:nextScene()},function(){function rotateGif(gif,index){if(gif){var canvas=gif.canvases[gif.getFrame()];canvas&&(state.slots[index]=canvas)}}function cancel(e){return e=e||event,e.preventDefault(),!1}function getFoePosition(foe){var x,y,foeScale=foe[3]/3/state.slots[2].getH(),t=time-foe[2];x=foe[0]-t/2;var h=foe[3]<=100?(1.5*t%(2*foe[3])-foe[3])/foe[3]:(t/4%(2*foe[3])-foe[3])/foe[3];return h=1-h*h,y=0===foe[4]?400-state.slots[2].getH()*foeScale-h*foe[3]/2:h*foe[3]/2,ppos.x=x+state.slots[2].getW()*foeScale/2,ppos.y=y+state.slots[2].getH()*foeScale/2,ppos}function drawFoe(foe){var foeScale=foe[3]/3/state.slots[2].getH(),pos=(time-foe[2],getFoePosition(foe));foe[5]<foe[6]&&(ctx.save(),ctx.beginPath(),ctx.arc(pos.x,pos.y,Math.min(state.slots[2].getW()*foeScale,state.slots[2].getH()*foeScale)/2,0,2*Math.PI,!0),ctx.closePath(),ctx.clip(),ctx.drawImage(state.slots[2],0*state.slots[2].getW(),0*state.slots[2].getW(),1*state.slots[2].getW(),1*state.slots[2].getH(),pos.x-state.slots[2].getW()*foeScale/2,pos.y-state.slots[2].getH()*foeScale/2,state.slots[2].getW()*foeScale,state.slots[2].getH()*foeScale),ctx.restore()),pos.x+100<0&&(gameOver?foe[5]=foe[6]:(foe[0]+=1e3+1e3*Math.random(),rand+=2*(Math.random()-.5),rand=Math.max(0,rand),foe[5]=0))}function drawLine(line){var t=time-line[3],x=line[0]-t/5;ctx.moveTo(x,line[1]),ctx.lineTo(x+line[2],line[1]),x+line[1]<0&&(line[3]=time)}function drawBonus(bonus){var t=time-bonus[2],size=25*bonus[4],scale=size/state.slots[1].getH(),x=bonus[0]-t/5,y=bonus[1]-state.slots[1].getH()*scale/2;bonus[3]||ctx.drawImage(state.slots[1],0*state.slots[1].getW(),0*state.slots[1].getH(),1*state.slots[1].getW(),1*state.slots[1].getH(),x,y,state.slots[1].getW()*scale,state.slots[1].getH()*scale),x+state.slots[1].getW()*scale<0&&(bonus[4]=!0)}function drawMountain(mountain){var t=time-mountain[2],x=mountain[0]-t/20,height=mountain[1]/2;ctx.beginPath(),ctx.moveTo(x,400),ctx.lineTo(x+height,400-height),ctx.lineTo(x+2*height,400),ctx.closePath(),ctx.fill(),x+2*height<0&&(mountain[2]=time)}function getShotPosition(shot,time,scaleFactor){var t=time-shot[2],scale=40/state.slots[3].getH()*scaleFactor,x=shot[0]+t,y=shot[1]+state.slots[3].getH()*scale/2,h=(t-300)/300;return h=1-h*h,y-=250*h,spos.x=x,spos.y=y,spos}function drawShot(shot){gameOver||(drawShotHelper(shot,time,1),hearts>=50&&(drawShotHelper(shot,time-20,.8),drawShotHelper(shot,time-40,.5)))}function drawShotHelper(shot,time,scaleFactor){var t=time-shot[2],scale=40/state.slots[3].getH()*scaleFactor,ppos=getShotPosition(shot,time,scaleFactor),angle=(t+shot[0]+shot[1])/100;shot[3]||(ctx.translate(ppos.x,ppos.y),ctx.rotate(angle),ctx.drawImage(state.slots[3],0,0,state.slots[3].getW(),state.slots[3].getW(),-state.slots[3].getW()*scale/2,-state.slots[3].getH()*scale/2,state.slots[3].getW()*scale,state.slots[3].getH()*scale),ctx.rotate(-angle),ctx.translate(-ppos.x,-ppos.y)),(t>800||shot[3])&&(shot[0]=pos[0],shot[1]=pos[1],shot[2]=time,shot[3]=!1,1===scaleFactor&&sounds.shoot.play())}function fetchParticle(){var particle=particles[particleIndex];return particleIndex=(particleIndex+1)%particles.length,particle}function throwParticle(x,y,img,bonus){var particle=fetchParticle();particle[0]=x,particle[1]=y,particle[2]=100*(Math.random()-.5),particle[3]=100*-(.5+Math.random()),particle[4]=time,particle[5]=img,particle[6]=!1,particle[7]=bonus,movingParticles.push(particle)}function breakParticle(particle){particle[7]=!1}function drawParticle(particle){var t=time-particle[4],img=particle[5],scale=20/img.getH(),x=particle[0]-img.getW()*scale+t/500*particle[2],y=particle[1],h=(t-250)/500;h=1-h*h,y+=h*particle[3];var final=3e3;if(particle[7]&&gameOver&&(particle[7]=!1),particle[7]){final=500+10*Math.abs(particle[2]);var tt=t/final;x=(1-tt)*x+45*tt,y=(1-tt)*y+45*tt}ctx.save();var angle=((particle[2]%2<1?time:-time)+particle[2]+particle[3])/200;ctx.translate(x,y),ctx.rotate(angle),ctx.beginPath(),ctx.arc(0,0,Math.min(img.getW()*scale,img.getH()*scale)/2,0,2*Math.PI,!0),ctx.closePath(),ctx.clip(),ctx.drawImage(particle[5],0,0,img.getW(),img.getH(),-img.getW()*scale/2,-img.getH()*scale/2,img.getW()*scale,img.getH()*scale),ctx.rotate(-angle),ctx.translate(-x,-y),ctx.restore(),t>final&&(particle[6]=!0,particle[7]&&(hearts++,pulse=time,score+=100*(hearts>=500?2:1)))}function checkBonus(bonus){if(!gameOver&&!bonus[3]&&(!hit||time-hit>1e3)){var t=time-bonus[2],scale=50/state.slots[1].getH(),x=bonus[0]-t/5+state.slots[1].getW()*scale/2,y=bonus[1]-state.slots[1].getH()*scale/2,radius=Math.min(state.slots[1].getW()*scale,state.slots[1].getH()*scale)/2,dx=pos[0]-x,dy=pos[1]-y,dist=Math.sqrt(dx*dx+dy*dy);if(dist<radius+pos[2]/2){bonus[3]=time;for(var count=3*bonus[4],p=0;p<count;p++)throwParticle(pos[0],pos[1],state.slots[1],!0);return void sounds.collect.play()}}}function checkCollision(foe){if(!gameOver&&foe[5]<foe[6]){var foeScale=foe[3]/3/state.slots[2].getH(),radius=Math.min(state.slots[2].getW()*foeScale,state.slots[2].getH()*foeScale)/2,ppos=getFoePosition(foe);if(!hit||time-hit>3e3){var dx=pos[0]-ppos.x,dy=pos[1]-ppos.y,dist=Math.sqrt(dx*dx+dy*dy);if(dist<radius+pos[2]/4){if(sounds.hit.play(),movingParticles.forEach(breakParticle),!hearts){gameOver=time,score>best&&(best=score,bestName=state.name,localStorage.setItem("best",best),localStorage.setItem("bestName",bestName),console.log(bestName));for(var p=0;p<8;p++)throwParticle(pos[0],pos[1],state.slots[0],!1);return}jumpy=-20,hit=time;for(var pcount=Math.min(particles.length,Math.ceil(hearts/3)),p=0;p<pcount;p++)throwParticle(pos[0],pos[1],state.slots[1],!1);hearts=0}}for(var i=0;i<shots.length;i++)if(!shots[i][3]){var spos=getShotPosition(shots[i],time,1);if(spos.x<900){var dx=ppos.x-spos.x,dy=ppos.y-spos.y,dist=Math.sqrt(dx*dx+dy*dy);if(dist<radius+10){if(foe[5]+=hearts>=50?2:1,shots[i][3]=!0,sounds.hit.play(),foe[5]>=foe[6]){var bonus=bonuses[bonusIndex];bonusIndex=(bonusIndex+1)%bonuses.length,bonus[0]=ppos.x,bonus[1]=ppos.y,bonus[2]=time,bonus[3]=!1,bonus[4]=foe[6],score+=1e3*(hearts>=500?2:1)}for(var count=foe[5]>=foe[6]?4*foe[6]:3,p=0;p<count;p++)throwParticle(ppos.x,ppos.y,foe[5]>=foe[6]?state.slots[2]:state.slots[3],!1)}}}}}function filterParticle(particle){return!particle[6]}function jump(justJump){var plane=hearts>=100;if(plane)pos[1]===400-pos[3]/2&&0===jumpy?(jumpy=-5,sounds.jump.play()):justJump?jumpy=-5:jumpy-=1.5;else{var doubleJump=hearts>=20;pos[1]===400-pos[3]/2&&0===jumpy?(jumpy=-16,jumpCount=1,sounds.jump.play()):doubleJump&&justJump&&1==jumpCount?(jumpy=-16,jumpCount=2,sounds.jump.play()):jumpy-=.5}}for(var gifSlots=[null,null,null,null],i=0;i<state.slots.length;i++)".gif"!==state.slots[i].src.slice(-4).toLowerCase()&&0!==state.slots[i].src.indexOf("data:image/gif;")||(gifSlots[i]=getGif(state.slots[i].src));window.gg=gifSlots,saveState("game",state),document.addEventListener("dragover",cancel),document.addEventListener("dragenter",cancel),document.addEventListener("dragleave",cancel),document.addEventListener("drop",cancel);for(var scale=50/state.slots[0].getH(),pos=[locations[0][0],locations[0][1],state.slots[0].getW()*scale,state.slots[0].getH()*scale],jumpy=0,bounce=0,bounceTime=0,currentTime=time,delay=time+1e3,lines=[[900,410,200,delay],[950,420,150,delay],[1e3,415,100,delay],[1100,435,170,delay],[1200,430,130,delay]],mountains=[[1970,150,delay],[2050,250,delay],[2130,200,delay],[3300,300,delay],[3450,270,delay]],foes=[[4e3,0,delay,300,0,0],[12e3,0,delay,500,0,0],[13e3,0,delay,100,0,0],[5e4,0,delay,100,0,0],[7e4,0,delay,350,0,0],[82e3,0,delay,100,1,0],[103e3,0,delay,100,1,0],[11e4,0,delay,100,1,0]],rand=2,ppos={},foes=[[4e3,0,delay,300,0,0,2],[12e3,0,delay,500,0,0,3],[13e3,0,delay,100,0,0,1],[2e4,0,delay,100,0,0,1],[22e3,0,delay,350,0,0,2],[42e3,0,delay,100,1,0,1],[50300,0,delay,100,1,0,1],[106100,0,delay,200,1,0,1]],bonuses=[[900,400,delay,!0,1],[900,400,delay,!0,1],[900,400,delay,!0,1],[900,400,delay,!0,1],[900,400,delay,!0,1],[900,400,delay,!0,1],[900,400,delay,!0,1],[900,400,delay,!0,1]],bonusIndex=0,shots=[[900,-1e3,delay,!0]],spos={},particles=new Array(100),i=0;i<particles.length;i++)particles[i]=[0,0,0,0,delay,null,!0,!1];var particleIndex=0,movingParticles=[],gameOver=0,hearts=0;loop=function(){clearCanvas();var w=time-bounceTime<200&&bounce?Math.cos((time-bounceTime)/10)*bounce/5:0;if(ctx.beginPath(),lines.forEach(drawLine),ctx.stroke(),ctx.fillStyle="#EEEEFF",mountains.forEach(drawMountain),foes.forEach(checkCollision),bonuses.forEach(checkBonus),bonuses.forEach(drawBonus),shots.forEach(drawShot),!gameOver&&(!hit||time-hit>3e3||time%100>30)){var doubleJump=hearts>=20&&hearts<100,plane=hearts>=100,x=pos[0],y=pos[1],flip=pos[1]<400-pos[3]/2&&2===jumpCount,angle=flip?jumpy*(400-pos[3]/2-pos[1])/2e3*Math.PI:hit&&time-hit<1e3?time:jumpy/100;ctx.translate(x,y),ctx.rotate(angle),ctx.drawImage(state.slots[0],0,0,state.slots[0].getW(),state.slots[0].getH(),w-pos[2]/2,-w-pos[3]/2,pos[2]-2*w,pos[3]+2*w),ctx.rotate(-angle),ctx.translate(-x,-y),doubleJump?(ctx.beginPath(),ctx.arc(x,y,pos[2]*(40+time%200)/200,Math.PI/2-Math.PI/8,Math.PI/2+Math.PI/8),ctx.stroke()):plane&&(ctx.beginPath(),ctx.arc(x,y,pos[2]*(40+time%200)/400,Math.PI-Math.PI/8,Math.PI+Math.PI/8),ctx.stroke(),ctx.beginPath(),ctx.arc(x,y,pos[2]*(40+time%200)/400,-Math.PI/8,+Math.PI/8),ctx.stroke())}foes.forEach(drawFoe),movingParticles.forEach(drawParticle);for(var i=movingParticles.length-1;i>=0;i--)filterParticle(movingParticles[i])||(movingParticles[i]=movingParticles[movingParticles.length-1],movingParticles.pop());if(!gameOver)for(;currentTime<time;)space&&jump(!1),pos[1]+pos[3]/2+jumpy>400?(pos[1]=400-pos[3]/2,bounceTime=time,bounce=jumpy,jumpy=-jumpy*bounceValue,jumpy>-1&&(jumpy=0,bounce=0,bounceTime=0)):pos[1]-pos[3]/2+jumpy<0?(bounceTime=time,bounce=jumpy,jumpy=-jumpy*bounceValue):pos[1]<400-pos[3]/2&&jumpy++,jumpy&&(pos[1]+=jumpy),currentTime+=20,score+=hearts>=500?2:1;if(gameOver||(makeBox(0,400,900,2),ctx.strokeRect.apply(ctx,box.map(Math.round))),hearts){var t=time-pulse,pu=Math.max(100-t,0)/10;ctx.drawImage(state.slots[1],0,0,state.slots[1].getW(),state.slots[1].getH(),20-pu/2,40-pu/2,30+pu,30+pu)}if(hearts>0&&(ctx.fillStyle="#AAAABB",ctx.font="20px Comic",hearts<20?ctx.fillText(hearts+" / 20: DBL JUMP",60,60):hearts<50?ctx.fillText(hearts+" / 50: DBL DMG",60,60):hearts<100?ctx.fillText(hearts+" / 100: WINGS",60,60):hearts<500?ctx.fillText(hearts+" / 500: DBL SCORE",60,60):ctx.fillText(hearts+" / 1000000000: GOD MODE",60,60)),score>0){visualScore+=(score-visualScore)/10,ctx.fillStyle="#AAAABB",ctx.font="20px Comic";var vScore=Math.round(visualScore);ctx.fillText(vScore>=best?vScore:vScore+" < "+best+" ("+bestName+")",30,30)}gifSlots.forEach(rotateGif),gameOver&&(ctx.fillStyle="#CCCCDD",ctx.font="60px Comic",ctx.fillText(makeText("GAME OVER",gameOver),270,220),makeBox(250,150,400,100),ctx.strokeRect.apply(ctx,box.map(Math.round)),ctx.font="25px Comic",ctx.fillText(makeText("Press the space bar to continue, esc to start over.",gameOver+11e3),210,400))};var f,f2,score=0,visualScore=0,pulse=0,hit=0,jumpCount=0;document.addEventListener("keydown",f=function(e){if(e=e||event,32===e.keyCode)if(gameOver){if(time-gameOver>3e3){loadState("game");loadGame(state)}}else jump(!space),space=!0;else 27===e.keyCode&&startOver();e.preventDefault()}),document.addEventListener("keyup",f2=function(e){e=e||event,32===e.keyCode&&(space=!1),e.preventDefault()});var space=!1;preNext=function(){document.removeEventListener("keydown",f),document.removeEventListener("keyup",f2),document.removeEventListener("dragover",cancel),document.removeEventListener("dragenter",cancel),document.removeEventListener("dragleave",cancel),document.removeEventListener("drop",cancel)}},nop],bounceValue=.2,locations=[[250,110],[250,165],[445,215],[345,265],[375,374,125,40]],timings=[4e3,8e3,15e3,18e3];scenes[0](),looper(0);var best=localStorage.getItem("best")||0,bestName=localStorage.getItem("bestName")||"";HTMLCanvasElement.prototype.getW=Image.prototype.getW=function(){return this.naturalWidth?this.naturalWidth:this.width},HTMLCanvasElement.prototype.getH=Image.prototype.getH=function(){return this.naturalHeight?this.naturalHeight:this.height},HTMLCanvasElement.prototype.src=null;