{"version":3,"sources":["../../../../lib/jsgif/O/lzw.js"],"names":["lzwDecode","minCodeSize","data","pos","readCode","size","code","i","charCodeAt","output","clearCode","eoiCode","codeSize","dict","clear","last","length","push","concat","console","assert","apply","tiny","wiki","sg","require","parseGIF","readFileSync","toString","sgl","blocks","lzwBlocks","reduce","s","n","sofa","a","String","fromCharCode","log","lzwMinCodeSize"],"mappings":";;AAEA,SAASA,SAAT,CAAmBC,WAAnB,EAAgCC,IAAhC,EAAsC;AACpC,MAAIC,MAAM,CAAV;;AAEA,WAASC,QAAT,CAAkBC,IAAlB,EAAwB;AACtB,QAAIC,OAAO,CAAX;AACA,SAAK,IAAIC,IAAI,CAAb,EAAgBA,IAAIF,IAApB,EAA0BE,GAA1B,EAA+B;AAC7B,UAAIL,KAAKM,UAAL,CAAgBL,OAAO,CAAvB,IAA6B,KAAMA,MAAM,CAA7C,EAAkD;AAChDG,gBAAQ,KAAKC,CAAb;AACD;AACDJ;AACD;AACD,WAAOG,IAAP;AACD;;AAED,MAAIG,SAAS,EAAb;;AAEA,MAAIC,YAAY,KAAKT,WAArB;AACA,MAAIU,UAAUD,YAAY,CAA1B;;AAEA,MAAIE,WAAWX,cAAc,CAA7B;;AAEA,MAAIY,OAAO,EAAX;;AAEA,WAASC,KAAT,GAAiB;AACfD,WAAO,EAAP;AACAD,eAAWX,cAAc,CAAzB;AACA,SAAK,IAAIM,IAAI,CAAb,EAAgBA,IAAIG,SAApB,EAA+BH,GAA/B,EAAoC;AAClCM,WAAKN,CAAL,IAAU,CAACA,CAAD,CAAV;AACD;AACDM,SAAKH,SAAL,IAAkB,EAAlB;AACAG,SAAKF,OAAL,IAAgB,IAAhB;AAED;;AAED,MAAIL,IAAJ;AACA,MAAIS,IAAJ;;AAEA,SAAO,IAAP,EAAa;AACXA,WAAOT,IAAP;AACAA,WAAOF,SAASQ,QAAT,CAAP;;AAEA,QAAIN,QAAQI,SAAZ,EAAuB;AACrBI;AACA;AACD;AACD,QAAIR,QAAQK,OAAZ,EAAqB;;AAErB,QAAIL,OAAOO,KAAKG,MAAhB,EAAwB;AACtB,UAAID,QAAQL,SAAZ,EAAuB;AACrBG,aAAKI,IAAL,CAAUJ,KAAKE,IAAL,EAAWG,MAAX,CAAkBL,KAAKP,IAAL,EAAW,CAAX,CAAlB,CAAV;AACD;AACF,KAJD,MAIO;AACLa,cAAQC,MAAR,CAAed,QAAQO,KAAKG,MAA5B;AACAH,WAAKI,IAAL,CAAUJ,KAAKE,IAAL,EAAWG,MAAX,CAAkBL,KAAKE,IAAL,EAAW,CAAX,CAAlB,CAAV;AACD;AACDN,WAAOQ,IAAP,CAAYI,KAAZ,CAAkBZ,MAAlB,EAA0BI,KAAKP,IAAL,CAA1B;;AAEA,QAAIO,KAAKG,MAAL,IAAgB,KAAKJ,QAArB,IAAkCA,WAAW,EAAjD,EAAqD;AACnD;AACAA;AACD;AACF;;AAEDO,UAAQC,MAAR,CAAe,CAACjB,OAAO,CAAR,IAAa,CAAC,EAAEA,MAAM,CAAR,CAAd,IAA4BD,KAAKc,MAAhD;AACA,SAAOP,MAAP;AACD;;AAOD,IAAIa,OAAO,CAAC,EAAD,EAAI,CAAJ,CAAX,C,CAAmB;AACnB,IAAIC,OAAO,CAAC,CAAD,EAAG,EAAH,EAAM,CAAN,EAAQ,EAAR,EAAW,EAAX,EAAc,GAAd,EAAkB,GAAlB,EAAsB,GAAtB,EAA0B,GAA1B,EAA8B,CAA9B,EAAgC,EAAhC,EAAmC,GAAnC,EAAuC,EAAvC,EAA0C,GAA1C,EAA8C,GAA9C,EAAkD,GAAlD,EAAsD,EAAtD,EAAyD,GAAzD,EAA6D,CAA7D,EAA+D,CAA/D,EAAiE,EAAjE,EAAoE,GAApE,EAAwE,EAAxE,EAA2E,EAA3E,EAA8E,GAA9E,EAAkF,EAAlF,EAAqF,GAArF,EAAyF,EAAzF,EAA4F,EAA5F,EAA+F,EAA/F,EAAkG,EAAlG,EAAqG,GAArG,EAAyG,EAAzG,EAA4G,GAA5G,EAAgH,GAAhH,EAAoH,GAApH,EAAwH,EAAxH,EAA2H,EAA3H,EAA8H,GAA9H,EAAkI,GAAlI,EAAsI,GAAtI,EAA0I,GAA1I,EAA8I,EAA9I,EAAiJ,GAAjJ,EAAqJ,GAArJ,EAAyJ,EAAzJ,EAA4J,EAA5J,EAA+J,GAA/J,EAAmK,EAAnK,EAAsK,GAAtK,EAA0K,GAA1K,EAA8K,EAA9K,EAAiL,GAAjL,EAAqL,GAArL,EAAyL,EAAzL,EAA4L,EAA5L,EAA+L,GAA/L,EAAmM,GAAnM,EAAuM,GAAvM,EAA2M,GAA3M,EAA+M,GAA/M,EAAmN,EAAnN,EAAsN,GAAtN,EAA0N,EAA1N,EAA6N,GAA7N,EAAiO,EAAjO,EAAoO,GAApO,EAAwO,GAAxO,EAA4O,GAA5O,EAAgP,EAAhP,EAAmP,EAAnP,EAAsP,GAAtP,EAA0P,EAA1P,EAA6P,GAA7P,EAAiQ,GAAjQ,EAAqQ,GAArQ,EAAyQ,CAAzQ,EAA2Q,GAA3Q,EAA+Q,EAA/Q,EAAkR,EAAlR,EAAqR,GAArR,EAAyR,EAAzR,EAA4R,GAA5R,EAAgS,EAAhS,EAAmS,GAAnS,EAAuS,EAAvS,EAA0S,GAA1S,EAA8S,GAA9S,EAAkT,GAAlT,EAAsT,GAAtT,EAA0T,EAA1T,EAA6T,EAA7T,EAAgU,EAAhU,EAAmU,GAAnU,EAAuU,EAAvU,EAA0U,GAA1U,EAA8U,GAA9U,EAAkV,EAAlV,EAAqV,GAArV,EAAyV,EAAzV,EAA4V,GAA5V,EAAgW,EAAhW,EAAmW,EAAnW,EAAsW,GAAtW,EAA0W,GAA1W,EAA8W,GAA9W,EAAkX,EAAlX,EAAqX,GAArX,EAAyX,EAAzX,EAA4X,GAA5X,EAAgY,GAAhY,EAAoY,EAApY,EAAuY,GAAvY,EAA2Y,GAA3Y,EAA+Y,EAA/Y,EAAkZ,GAAlZ,EAAsZ,GAAtZ,EAA0Z,GAA1Z,EAA8Z,GAA9Z,EAAka,GAAla,EAAsa,EAAta,EAAya,GAAza,EAA6a,GAA7a,EAAib,GAAjb,EAAqb,GAArb,EAAyb,GAAzb,EAA6b,GAA7b,EAAic,GAAjc,EAAqc,GAArc,EAAyc,GAAzc,EAA6c,EAA7c,EAAgd,GAAhd,EAAod,GAApd,EAAwd,GAAxd,EAA4d,GAA5d,EAAge,GAAhe,EAAoe,GAApe,EAAwe,GAAxe,EAA4e,GAA5e,EAAgf,GAAhf,EAAof,GAApf,EAAwf,GAAxf,EAA4f,GAA5f,EAAggB,GAAhgB,EAAogB,GAApgB,EAAwgB,EAAxgB,EAA2gB,CAA3gB,EAA6gB,GAA7gB,EAAihB,EAAjhB,EAAohB,EAAphB,EAAuhB,GAAvhB,EAA2hB,EAA3hB,EAA8hB,GAA9hB,EAAkiB,GAAliB,EAAsiB,GAAtiB,EAA0iB,EAA1iB,EAA6iB,GAA7iB,EAAijB,GAAjjB,EAAqjB,EAArjB,EAAwjB,GAAxjB,EAA4jB,EAA5jB,EAA+jB,GAA/jB,EAAmkB,EAAnkB,EAAskB,EAAtkB,EAAykB,EAAzkB,EAA4kB,EAA5kB,EAA+kB,CAA/kB,CAAX,C,CAA6lB;AAC7lB,IAAIC,KAAKC,QAAQ,OAAR,EAAiBC,QAAjB,CAA0BD,QAAQ,IAAR,EAAcE,YAAd,CAA2B,YAA3B,EAAyCC,QAAzC,CAAkD,QAAlD,CAA1B,CAAT;AACA,IAAIC,MAAML,GAAGM,MAAH,CAAU,CAAV,EAAaC,SAAb,CAAuBC,MAAvB,CAA8B,UAASC,CAAT,EAAWC,CAAX,EAAc;AAAE,SAAOD,IAAIC,EAAEhC,IAAb;AAAoB,CAAlE,EAAoE,EAApE,CAAV;;AAEA,SAASiC,IAAT,CAAcC,CAAd,EAAiB;AACf,SAAOA,EAAEJ,MAAF,CAAS,UAASC,CAAT,EAAWC,CAAX,EAAc;AAAE,WAAOD,IAAII,OAAOC,YAAP,CAAoBJ,CAApB,CAAX;AAAoC,GAA7D,EAA+D,EAA/D,CAAP;AACD;;AAEDf,QAAQoB,GAAR;AACI;AACA;AACA;AACAvC,UAAUwB,GAAGM,MAAH,CAAU,CAAV,EAAaU,cAAvB,EAAuCX,GAAvC,CAJJ;;AAOA;AACA;AACA;AACA;AACA","file":"lzw.js","sourcesContent":["\n\nfunction lzwDecode(minCodeSize, data) {\n  var pos = 0;\n\n  function readCode(size) {\n    var code = 0;\n    for (var i = 0; i < size; i++) {\n      if (data.charCodeAt(pos >> 3) & (1 << (pos % 8))) {\n        code |= 1 << i;\n      }\n      pos++;\n    }\n    return code;\n  }\n\n  var output = [];\n\n  var clearCode = 1 << minCodeSize;\n  var eoiCode = clearCode + 1;\n\n  var codeSize = minCodeSize + 1;\n\n  var dict = [];\n\n  function clear() {\n    dict = [];\n    codeSize = minCodeSize + 1;\n    for (var i = 0; i < clearCode; i++) {\n      dict[i] = [i];\n    }\n    dict[clearCode] = [];\n    dict[eoiCode] = null;\n\n  }\n\n  var code;\n  var last;\n\n  while (true) {\n    last = code;\n    code = readCode(codeSize);\n\n    if (code == clearCode) {\n      clear();\n      continue;\n    }\n    if (code == eoiCode) break;\n\n    if (code < dict.length) {\n      if (last != clearCode) {\n        dict.push(dict[last].concat(dict[code][0]));\n      }\n    } else {\n      console.assert(code == dict.length);\n      dict.push(dict[last].concat(dict[last][0]));\n    }\n    output.push.apply(output, dict[code]);\n\n    if (dict.length == (1 << codeSize) && codeSize < 12) {\n      // If we're at the last code and codeSize is 12, the next code will be a clearCode, and it'll be 12 bits long.\n      codeSize++;\n    }\n  }\n\n  console.assert((pos >> 3) + !!(pos % 8) == data.length);\n  return output;\n}\n\n\n\n\n\n\nvar tiny = [68,1]; // 2\nvar wiki = [0,81,8,28,72,176,160,193,131,8,15,254,91,200,176,161,67,135,9,7,62,156,56,49,162,64,138,24,25,90,68,145,49,227,198,142,24,63,130,172,104,113,36,201,136,38,31,138,76,169,177,36,203,150,30,19,198,140,137,112,102,72,153,55,105,42,204,121,179,38,79,138,40,127,158,220,9,148,99,79,162,36,117,26,180,89,212,103,209,151,35,47,66,237,40,117,170,80,171,42,141,98,77,186,149,107,87,136,90,191,194,20,219,176,42,217,127,102,201,166,21,187,246,107,219,174,111,183,198,197,58,215,106,221,169,119,161,230,125,185,151,101,223,148,127,77,6,142,26,86,109,97,182,135,221,38,134,187,88,110,99,186,27,35,31,12,8] // 8\nvar sg = require('./gif').parseGIF(require('fs').readFileSync('dollar.gif').toString('binary'));\nvar sgl = sg.blocks[1].lzwBlocks.reduce(function(s,n) { return s + n.data; }, '');\n\nfunction sofa(a) {\n  return a.reduce(function(s,n) { return s + String.fromCharCode(n); }, '');\n}\n\nconsole.log(\n    //lzwDecode(2, sofa(tiny))\n    //lzwDecode(2, \"D\\x01\")\n    //lzwDecode(8, sofa(wiki))\n    lzwDecode(sg.blocks[1].lzwMinCodeSize, sgl)\n)\n\n//x = lzwDecode(8, sofa(wiki));\n//for (var i = 0; i < x.length; i++) {\n//  //if (x[i] == 255) continue;\n//  console.log(x[i]);\n//}\n"]}