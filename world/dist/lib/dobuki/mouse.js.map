{"version":3,"sources":["../../../lib/dobuki/mouse.js"],"names":["global","factory","exports","module","define","amd","DOK","core","spot","x","y","callbacks","touchSpotX","touchSpotY","mdown","requireScripts","logScript","onDown","e","target","attributes","undefined","touches","changedTouches","i","length","touch","identifier","pageX","pageY","preventDefault","onUp","hasTouch","onMove","buttons","newX","newY","dx","dy","setOnTouch","func","deactivateTouch","activateTouch","push","document","addEventListener","removeEventListener","destroyEverything","combineMethods"],"mappings":"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","file":"mouse.js","sourcesContent":["(function (global, factory) {\n \ttypeof exports === 'object' && typeof module !== 'undefined' ? factory(exports) :\n \ttypeof define === 'function' && define.amd ? define(['exports'], factory) :\n \t(factory((global.DOK = global.DOK || {})));\n }(this, (function (core) { 'use strict';\n    \n    var spot = {x:0,y:0}, callbacks = [];\n    var touchSpotX = {}, touchSpotY = {};\n    var mdown = false;\n    /**\n     *  HEADER\n     */   \n    core.requireScripts([\n        'setup.js',\n    ]);\n    core.logScript();\n\n    /**\n     *  FUNCTION DEFINITIONS\n     */   \n    function onDown(e)\n    {\n        if(e.target.attributes['tap']===undefined) {\n            var touches = e.changedTouches;\n            if(touches) {\n                for(var i=0;i<touches.length;i++) {\n                    var touch = touches[i];\n                    touchSpotX[touch.identifier] =touch.pageX;\n                    touchSpotY[touch.identifier] =touch.pageY;\n                }\n            } else {\n                spot.x = e.pageX;\n                spot.y = e.pageY;\n            }\n            mdown = true;\n            for(var i=0;i<callbacks.length;i++) {\n                callbacks[i](null,null,true,e.pageX,e.pageY);\n            }\n        }\n        e.preventDefault();\n    }\n    \n    function onUp(e) {\n\n        var hasTouch = false;\n        if(e.changedTouches) {\n            for(var i=0;i<e.changedTouches.length;i++) {\n                delete touchSpotX[touch.identifier];\n                delete touchSpotY[touch.identifier];\n            }\n            for(var i in touchSpotX) {\n                hasTouch = true;\n            }\n\n        }\n\n        for(var i=0;i<callbacks.length;i++) {\n            callbacks[i](null,null, hasTouch,e.pageX,e.pageY);\n        }\n        mdown = false;\n        e.preventDefault();\n    }\n    \n    function onMove(e) {\n        var touches = e.changedTouches;\n        if(!touches) {\n            if(e.buttons & 1 && mdown) {\n                var newX = e.pageX;\n                var newY = e.pageY;\n                var dx = newX - spot.x;\n                var dy = newY - spot.y;\n                spot.x = newX;\n                spot.y = newY;\n                for(var i=0;i<callbacks.length;i++) {\n                    callbacks[i](dx,dy,true,e.pageX,e.pageY);\n                }\n            } else {\n                mdown = false;\n                for(var i=0;i<callbacks.length;i++) {\n                    callbacks[i](dx,dy,false,e.pageX,e.pageY);\n                }\n            }\n        } else if(mdown) {\n            var dx = 0, dy = 0;\n            for(var i=0;i<touches.length;i++) {\n                var touch = touches[i];\n                dx += touch.pageX - touchSpotX[touch.identifier];\n                dy += touch.pageY - touchSpotY[touch.identifier];\n                touchSpotX[touch.identifier] = touch.pageX;\n                touchSpotY[touch.identifier] = touch.pageY;\n            }\n            for(var i=0;i<callbacks.length;i++) {\n                callbacks[i](dx,dy,true,e.pageX,e.pageY);\n            }\n        }\n        e.preventDefault();\n    }\n\n    function setOnTouch(func) {\n        deactivateTouch();\n        activateTouch();\n        callbacks.push(func);\n    }\n\n    function activateTouch() {\n\n        document.addEventListener(\"mousedown\", onDown);\n        document.addEventListener(\"touchstart\", onDown);\n        document.addEventListener(\"mouseup\", onUp);\n        document.addEventListener(\"touchend\", onUp);\n        document.addEventListener(\"touchcancel\", onUp);\n        document.addEventListener(\"mousemove\", onMove);\n        document.addEventListener(\"touchmove\", onMove);\n    }\n\n    function deactivateTouch() {\n        document.removeEventListener(\"mousedown\", onDown);\n        document.removeEventListener(\"touchstart\", onDown);\n        document.removeEventListener(\"mouseup\", onUp);\n        document.removeEventListener(\"touchend\", onUp);\n        document.removeEventListener(\"touchcancel\", onUp);\n        document.removeEventListener(\"mousemove\", onMove);\n        document.removeEventListener(\"touchmove\", onMove);\n    }\n\n    function destroyEverything() {\n        callbacks = [];\n        deactivateTouch();\n    }\n   \n    /**\n     *  PUBLIC DECLARATIONS\n     */\n    core.setOnTouch = setOnTouch;\n    core.destroyEverything = core.combineMethods(destroyEverything, core.destroyEverything);\n\n    /**\n     *   PROCESSES\n     */\n\n })));"]}