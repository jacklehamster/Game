{"version":3,"sources":["../../../lib/dobuki/loop.js"],"names":["global","factory","exports","module","define","amd","DOK","core","coreLoops","frame","fps","period","Math","floor","nextTime","lastCount","frameCount","loop","time","loops","requestAnimationFrame","i","length","addLoop","callback","beginLoop","push","removeLoop","index","indexOf","splice","loopTime","performance","now","destroyEverything","combineMethods","Object","defineProperty","enumerable","configurable","get","set","value","requireScripts","logScript"],"mappings":"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","file":"loop.js","sourcesContent":["(function (global, factory) {\n \ttypeof exports === 'object' && typeof module !== 'undefined' ? factory(exports) :\n \ttypeof define === 'function' && define.amd ? define(['exports'], factory) :\n \t(factory((global.DOK = global.DOK || {})));\n }(this, (function (core) { 'use strict';\n \n    var coreLoops = null;\n    var frame = 0;\n    var fps = 0;\n    var period = Math.floor(1000/60);\n    var nextTime = 0;\n    var lastCount = 0;\n\n    var frameCount = 0;\n\n    /**\n    *  FUNCTION DEFINITIONS\n    */\n    function loop(time) {\n        if(coreLoops) {\n            var loops = coreLoops;\n            requestAnimationFrame( loop );\n            if(time<=core.time + period) {\n                return;\n            }\n            core.time = Math.floor(time/period)*period;\n            for(var i=0;i<loops.length;i++)  {\n                loops[i]();\n            }\n            frameCount ++;\n            if(time-lastCount>1000) {\n                fps = frameCount;\n                frameCount = 0;\n                lastCount = time;\n            }\n        }\n    }\n\n    function addLoop(callback) {\n        if(coreLoops===null) {\n            coreLoops = [];\n            beginLoop();\n        }\n        coreLoops.push(callback);\n    }\n\n    function removeLoop(callback) {\n        if(coreLoops) {\n            var index = coreLoops.indexOf(callback);\n            coreLoops.splice(index, 1);\n            if(coreLoops.length===0) {\n                coreLoops = null;\n            }\n        }\n    }\n\n    function beginLoop() {\n        loop(0);\n    }\n\n    function loopTime() {\n        return performance.now() - core.time;\n    }\n\n    function destroyEverything() {\n        coreLoops = null;\n        frame = 0;\n        fps = 0;\n        period = Math.floor(1000/60);\n        nextTime = 0;\n        lastCount = 0;\n        frameCount = 0;\n    }\n\n    /**\n    *  PUBLIC DECLARATIONS\n    */\n    core.addLoop = addLoop;\n    core.removeLoop = removeLoop;\n    core.destroyEverything = core.combineMethods(destroyEverything, core.destroyEverything);\n\n    Object.defineProperty(core, \"fps\", {\n        enumerable: false,\n        configurable: false,\n        get: function () {\n            return fps;\n        },\n        set: function(value) {\n            period = Math.floor(1000/value);\n        }\n    });\n\n\n    /**\n    *   PROCESSES\n    */\n    core.requireScripts(['setup.js']);\n    core.logScript();\n    core.time = 0;\n\n })));"]}