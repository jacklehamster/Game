{"version":3,"sources":["../../../lib/dobuki/editcontrol.js"],"names":["global","factory","exports","module","define","amd","DOK","window","core","point","x","y","active","downTime","camRotation","THREE","Euler","centerizer","loop","camera","getCamera","setFromQuaternion","quaternion","z","Math","abs","setFromEuler","requireScripts","logScript","addControlBall","cam","ball","document","createElement","width","height","style","position","zIndex","top","left","innerWidth","context","getContext","beginPath","arc","PI","fillStyle","fill","menus","selection","id","list","action","cam3d","isCamera3d","refreshMenus","setCamera3d","addEventListener","e","showMenu","hideMenu","pageX","pageY","activateBallControl","preventDefault","body","appendChild","ballMouseMove","buttons","dx","dy","anyKeyPressed","rotateZ","rotateY","rotateX","deactivateBallControl","boxMouseMove","precamZ","translateZ","mouseUpBall","mouseUpBox","deactivateBoxControl","time","removeEventListener","trigger","activateBoxControl","addControlBox","box","rect","destroyEverything","combineMethods"],"mappings":"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","file":"editcontrol.js","sourcesContent":["(function (global, factory) {\n    typeof exports === 'object' && typeof module !== 'undefined' ? factory(exports) :\n        typeof define === 'function' && define.amd ? define(['exports'], factory) :\n            (factory((global.DOK = global.DOK || {}), global));\n}(window, (function (core, global) { 'use strict';\n\n    var point = { x: 0, y: 0, active:false };\n    var downTime = 0;\n    var camRotation = new THREE.Euler();\n    var centerizer = {\n        loop: function() {\n            var camera = core.getCamera();\n            camRotation.setFromQuaternion(camera.quaternion);\n            camRotation.z *= .8;\n            if (Math.abs(camRotation.z) < .01) {\n                camRotation.z = 0;\n                camera.quaternion.setFromEuler(camRotation);\n                return false;\n            } else {\n                camera.quaternion.setFromEuler(camRotation);\n            }\n        }\n    };\n\n    /**\n     *  HEADER\n     */\n    core.requireScripts([\n        'setup.js',\n        'menu.js',\n        'camera.js',\n    ]);\n    core.logScript();\n\n    /**\n     *  FUNCTION DEFINITIONS\n     */\n    function addControlBall(cam) {\n        var ball = document.createElement(\"canvas\");\n        ball.width = 100;\n        ball.height = 100;\n        ball.style.position = \"absolute\";\n        ball.style.width = \"50px\";\n        ball.style.height = \"50px\";\n        ball.style.zIndex = 1;\n        ball.style.top = 0;\n        ball.style.left = (window.innerWidth - 50)+\"px\";\n\n        var context = ball.getContext(\"2d\");\n        context.beginPath();\n        context.arc(50, 50, 40, 0, 2 * Math.PI, false);\n        context.fillStyle = 'green';\n        context.fill();\n\n        var menus = {\n            camera: {\n                selection: 0,\n                id: \"cameraMenu\",\n                position: [30,30],\n                list: [\n                    \"CAMERA PERSPECTIVE\",\n                ],\n                action: function(selection) {\n                    if(selection===0) {\n                        var cam3d = DOK.isCamera3d();\n                        cam3d = !cam3d;\n                        this.list[selection] = cam3d ? \"CAMERA PERSPECTIVE\" : \"CAMERA ORTHOGRAPHIC\";\n                        DOK.refreshMenus();\n                        DOK.setCamera3d(cam3d);\n                    }\n                },\n            },\n        };\n\n        ball.addEventListener(\"mouseover\", function(e) {\n            core.showMenu(menus.camera, true);\n        });\n        ball.addEventListener(\"mouseout\", function(e) {\n            core.hideMenu(menus.camera);\n        });\n\n        ball.addEventListener(\"mousedown\", function(e) {\n            var camera = core.getCamera();\n            point.x = e.pageX;\n            point.y = e.pageY;\n            activateBallControl();\n            core.hideMenu(menus.camera);\n            e.preventDefault();\n        });\n\n        window.addEventListener(\"resize\",\n            function() {\n                ball.style.left = (window.innerWidth - 50)+\"px\";\n            }\n        );\n        document.body.appendChild(ball);\n    }\n\n    function ballMouseMove(e) {\n        if(e.buttons===1 && point.active) {\n            var camera = core.getCamera();\n            var dx = e.pageX - point.x;\n            var dy = e.pageY - point.y;\n            if(DOK.anyKeyPressed(16)) {\n                camera.rotateZ(dx/100);\n            } else {\n                camera.rotateY(dx/100);\n            }\n            camera.rotateX(dy/100);\n            point.x = e.pageX;\n            point.y = e.pageY;\n        } else {\n            deactivateBallControl();\n        }\n        e.preventDefault();\n    }\n\n    function boxMouseMove(e) {\n        if(e.buttons===1 && point.active) {\n            var camera = core.getCamera();\n            var dx = e.pageX - point.x;\n            var dy = e.pageY - point.y;\n//            camera.translateX(-dx*10);\n            var precamZ = camera.position.z;\n            camera.position.x += -dx*10;\n            if(DOK.anyKeyPressed(16)) {\n                camera.translateZ(-dy*10);\n            } else {\n//                camera.translateY(dy*10);\n                camera.position.y += (dy*10);\n            }\n            camera.position.z = precamZ;\n            point.x = e.pageX;\n            point.y = e.pageY;\n        } else {\n            deactivateBallControl();\n        }\n        e.preventDefault();\n    }\n\n    function mouseUpBall(e) {\n        deactivateBallControl();\n    }\n\n    function mouseUpBox(e) {\n        deactivateBoxControl();\n    }\n\n    function activateBallControl() {\n        if(!point.active) {\n            document.addEventListener(\"mousemove\", ballMouseMove);\n            document.addEventListener(\"mouseup\", mouseUpBall);\n            point.active = true;\n            downTime = core.time;\n        }\n    }\n\n    function deactivateBallControl() {\n        if(point.active) {\n            document.removeEventListener(\"mousemove\", ballMouseMove);\n            document.removeEventListener(\"mouseup\", mouseUpBall);\n            point.active = false;\n            if(core.time - downTime < 150) {\n                core.trigger(centerizer);\n            }\n            downTime = 0;\n        }\n    }\n\n    function activateBoxControl() {\n        if(!point.active) {\n            document.addEventListener(\"mousemove\", boxMouseMove);\n            document.addEventListener(\"mouseup\", mouseUpBox);\n            point.active = true;\n            downTime = core.time;\n        }\n    }\n\n    function deactivateBoxControl() {\n        if(point.active) {\n            document.removeEventListener(\"mousemove\", boxMouseMove);\n            document.removeEventListener(\"mouseup\", mouseUpBox);\n            point.active = false;\n            downTime = 0;\n        }\n    }\n\n    function addControlBox(cam) {\n        var box = document.createElement(\"canvas\");\n        box.width = 100;\n        box.height = 100;\n        box.style.position = \"absolute\";\n        box.style.width = \"50px\";\n        box.style.height = \"50px\";\n        box.style.zIndex = 1;\n        box.style.top = \"50px\";\n        box.style.left = (window.innerWidth - 50)+\"px\";\n\n        var context = box.getContext(\"2d\");\n        context.beginPath();\n        context.rect(30,10,40,90);\n        context.fillStyle = 'green';\n        context.fill();\n\n        box.addEventListener(\"mousedown\", function(e) {\n            var camera = core.getCamera();\n            point.x = e.pageX;\n            point.y = e.pageY;\n            activateBoxControl();\n            e.preventDefault();\n        });\n\n        window.addEventListener(\"resize\",\n            function() {\n                box.style.left = (window.innerWidth - 50)+\"px\";\n            }\n        );\n        document.body.appendChild(box);\n    }\n\n    function destroyEverything() {\n    }\n\n    /**\n     *  PUBLIC DECLARATIONS\n     */\n    core.addControlBall = addControlBall;\n    core.addControlBox = addControlBox;\n    core.destroyEverything = core.combineMethods(destroyEverything, core.destroyEverything);\n\n    /**\n     *   PROCESSES\n     */\n\n\n})));"]}