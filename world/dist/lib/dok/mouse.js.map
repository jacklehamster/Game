{"version":3,"sources":["../../../lib/dok/mouse.js"],"names":["define","Utils","spot","x","y","callbacks","touchSpotX","touchSpotY","mdown","onDown","e","target","attributes","undefined","touches","changedTouches","i","length","touch","identifier","pageX","pageY","preventDefault","onUp","hasTouch","onMove","buttons","newX","newY","dx","dy","setOnTouch","func","deactivateTouch","activateTouch","push","document","addEventListener","removeEventListener","destroyEverything","Mouse","onDestroy"],"mappings":"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","file":"mouse.js","sourcesContent":["define([ 'dok/utils' ], function(Utils) {\n\n    'use strict';\n\n    var spot = {x:0,y:0}, callbacks = [];\n    var touchSpotX = {}, touchSpotY = {};\n    var mdown = false;\n\n    /**\n     *  FUNCTION DEFINITIONS\n     */   \n    function onDown(e)\n    {\n        if(e.target.attributes['tap']===undefined) {\n            var touches = e.changedTouches;\n            if(touches) {\n                for(var i=0;i<touches.length;i++) {\n                    var touch = touches[i];\n                    touchSpotX[touch.identifier] =touch.pageX;\n                    touchSpotY[touch.identifier] =touch.pageY;\n                }\n            } else {\n                spot.x = e.pageX;\n                spot.y = e.pageY;\n            }\n            mdown = true;\n            for(var i=0;i<callbacks.length;i++) {\n                callbacks[i](null,null,true,e.pageX,e.pageY);\n            }\n        }\n        e.preventDefault();\n    }\n    \n    function onUp(e) {\n\n        var hasTouch = false;\n        if(e.changedTouches) {\n            for(var i=0;i<e.changedTouches.length;i++) {\n                delete touchSpotX[touch.identifier];\n                delete touchSpotY[touch.identifier];\n            }\n            for(var i in touchSpotX) {\n                hasTouch = true;\n            }\n\n        }\n\n        for(var i=0;i<callbacks.length;i++) {\n            callbacks[i](null,null, hasTouch,e.pageX,e.pageY);\n        }\n        mdown = false;\n        e.preventDefault();\n    }\n    \n    function onMove(e) {\n        var touches = e.changedTouches;\n        if(!touches) {\n            if(e.buttons & 1 && mdown) {\n                var newX = e.pageX;\n                var newY = e.pageY;\n                var dx = newX - spot.x;\n                var dy = newY - spot.y;\n                spot.x = newX;\n                spot.y = newY;\n                for(var i=0;i<callbacks.length;i++) {\n                    callbacks[i](dx,dy,true,e.pageX,e.pageY);\n                }\n            } else {\n                mdown = false;\n                for(var i=0;i<callbacks.length;i++) {\n                    callbacks[i](dx,dy,false,e.pageX,e.pageY);\n                }\n            }\n        } else if(mdown) {\n            var dx = 0, dy = 0;\n            for(var i=0;i<touches.length;i++) {\n                var touch = touches[i];\n                dx += touch.pageX - touchSpotX[touch.identifier];\n                dy += touch.pageY - touchSpotY[touch.identifier];\n                touchSpotX[touch.identifier] = touch.pageX;\n                touchSpotY[touch.identifier] = touch.pageY;\n            }\n            for(var i=0;i<callbacks.length;i++) {\n                callbacks[i](dx,dy,true,e.pageX,e.pageY);\n            }\n        }\n        e.preventDefault();\n    }\n\n    function setOnTouch(func) {\n        deactivateTouch();\n        activateTouch();\n        callbacks.push(func);\n    }\n\n    function activateTouch() {\n\n        document.addEventListener(\"mousedown\", onDown);\n        document.addEventListener(\"touchstart\", onDown);\n        document.addEventListener(\"mouseup\", onUp);\n        document.addEventListener(\"touchend\", onUp);\n        document.addEventListener(\"touchcancel\", onUp);\n        document.addEventListener(\"mousemove\", onMove);\n        document.addEventListener(\"touchmove\", onMove);\n    }\n\n    function deactivateTouch() {\n        document.removeEventListener(\"mousedown\", onDown);\n        document.removeEventListener(\"touchstart\", onDown);\n        document.removeEventListener(\"mouseup\", onUp);\n        document.removeEventListener(\"touchend\", onUp);\n        document.removeEventListener(\"touchcancel\", onUp);\n        document.removeEventListener(\"mousemove\", onMove);\n        document.removeEventListener(\"touchmove\", onMove);\n    }\n\n    function destroyEverything() {\n        callbacks = [];\n        deactivateTouch();\n    }\n   \n    /**\n     *  PUBLIC DECLARATIONS\n     */\n    function Mouse() {\n    }\n    Mouse.setOnTouch = setOnTouch;\n\n    Utils.onDestroy(destroyEverything);\n\n    return Mouse;\n\n });"]}