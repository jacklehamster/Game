{"version":3,"sources":["../../game116/main.js"],"names":["require","THREE","DOK","window","debug","fps","location","search","indexOf","document","getElementById","style","display","engine","Engine","canvas","images","poop","toUrl","squid","normal","shadow","run","floor","sand","dirt","sprite","border","hand","left","right","coin","SpriteSheet","preLoad","getBorderedImage","index","spritesheet","cut","getCut","url","spriteRenderer","SpriteRenderer","scene","add","mesh","curvature","range","cellSize","renderer","setClearColor","roundabout","Utils","Roundabout","closestPoint","x","y","getClosestSpritePosition","limit","Math","round","reset","i","pos","next","sprites","spriteCollection","get","empty","obj","picked","uid","pickedItem","mouseControl","selectedObj","getSelected","xPos","mousePos","yPos","getCamPos","camera","position","collection","Collection","type","width","height","frame","Loop","time","sel","selected","spritePos","light","anim","img","abs","SpriteObject","create","Camera","quaternions","southQuaternionArray","spriteSelection","spriteCubes","spriteCube","spriteInfo","size","options","pickedMe","random","push","westQuaternionArray","eastQuaternionArray","forEach","setTypeCube","spriteObj","spriteFace","createSpriteCollection","spriteFunction","call","ss","getCamera","camGoal","Vector3","createSprite","cancel","e","event","mouseMoveTo","pageX","pageY","preventDefault","drop","dt","dataTransfer","reader","FileReader","file","files","addEventListener","console","log","Image","length","src","result","readAsDataURL","mouseMoveToVector","mouseVector","set","innerWidth","innerHeight","unproject","dir","sub","normalize","distance","z","copy","multiplyScalar","find","move","setIndexProcessor","count","image","zIndex","spriteObject","zoombar","zoomState","angle","setMouseControl","Mouse","setOnWheel","dx","dy","max","min","setOnZoom","pinchSize","setOnTouch","down","updateCamera","rotation","hero","speed","last","startTime","showCoin","lastTime","addLoop","gameStarted","Date","now","addSquid","addRunner","mov","Keyboard","getMove","dist","sqrt","actorsList","actor","touched","dz","runner","runners","pok","Audio","play","burst","jump","index2","actors","array","wave","h","scale","callback","getSprite","Array","isArray","ready","updateGraphics"],"mappings":"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","file":"main.js","sourcesContent":["require([\n    'threejs',\n    'dobuki',\n], function(THREE, DOK) {\n    window.DOK = DOK;\n\n    var debug = {\n        fps: location.search.indexOf(\"fps\")>=0,\n    };\n\n    document.getElementById(\"fps\").style.display = debug.fps ? \"\" : \"none\";\n\n    var engine = new DOK.Engine({\n        canvas: document.getElementById('abc'),\n    });\n\n    var images = {\n        poop:[\n            require.toUrl('poop.png'),\n            require.toUrl('poop.png|scale:-1,1'),\n        ],\n        squid: {\n            normal:[\n                require.toUrl(\"https://jacklehamster.github.io/dok/images/squid.png|0,0,32,32\"),\n                require.toUrl(\"https://jacklehamster.github.io/dok/images/squid.png|32,0,32,32\"),\n                require.toUrl(\"https://jacklehamster.github.io/dok/images/squid.png|0,32,32,32\"),\n                require.toUrl(\"https://jacklehamster.github.io/dok/images/squid.png|32,32,32,32\"),\n            ],\n            shadow:[\n                require.toUrl(\"https://jacklehamster.github.io/dok/images/squid.png|0,0,32,32|shadow\"),\n                require.toUrl(\"https://jacklehamster.github.io/dok/images/squid.png|32,0,32,32|shadow\"),\n                require.toUrl(\"https://jacklehamster.github.io/dok/images/squid.png|0,32,32,32|shadow\"),\n                require.toUrl(\"https://jacklehamster.github.io/dok/images/squid.png|32,32,32,32|shadow\"),\n            ],\n        },\n        run: require.toUrl('run.gif'),\n        floor: require.toUrl(\"https://jacklehamster.github.io/dok/images/wood.png\"),\n//        lava: require.toUrl('http://localhost/~vincent/game/world/lava.png'),\n        sand: [\n            require.toUrl('walk.jpg'),\n            require.toUrl('walk.jpg|scale:-1,1'),\n            require.toUrl('walk.jpg|scale:1,-1'),\n            require.toUrl('walk.jpg|scale:-1,-1'),\n        ],\n        dirt: [\n            require.toUrl('walkshit.jpg'),\n            require.toUrl('walkshit.jpg|scale:-1,1'),\n            require.toUrl('walkshit.jpg|scale:1,-1'),\n            require.toUrl('walkshit.jpg|scale:-1,-1'),\n        ],\n/*        water: [\n            require.toUrl(\"http://localhost/~vincent/game/world/water.jpg\"),\n            require.toUrl(\"http://localhost/~vincent/game/world/water.jpg|scale:-1,1\"),\n            require.toUrl(\"http://localhost/~vincent/game/world/water.jpg|scale:1,-1\"),\n            require.toUrl(\"http://localhost/~vincent/game/world/water.jpg|scale:-1,-1\"),\n        ],*/\n        sprite: [\n        ],\n        border: [\n        ],\n        hand: {\n            left: require.toUrl('shitterleft.gif'),\n            right: require.toUrl('shitter.gif'),\n//            down: require.toUrl('shitter.gif'),\n//            up: require.toUrl('shitter.gif'),\n//            down: require.toUrl('hand.png'),\n//            left: require.toUrl('hand-right.png|scale:-1,1'),\n//            right: require.toUrl('hand-right.png'),\n//            up: require.toUrl('hand-far.png'),\n        },\n        coin: require.toUrl('coin.png'),\n    };\n    DOK.SpriteSheet.preLoad(images);\n\n    function getBorderedImage(index) {\n        if(index in DOK.SpriteSheet.spritesheet.border) {\n            return DOK.SpriteSheet.spritesheet.border[index];\n        }\n        var cut = DOK.SpriteSheet.getCut(index);\n        images.border[index] = cut.url + \"|border:10%\";\n        DOK.SpriteSheet.preLoad(images);\n        return DOK.SpriteSheet.spritesheet.border[index];\n    }\n\n\n    var spriteRenderer = new DOK.SpriteRenderer();\n    engine.scene.add(spriteRenderer.mesh);\n    window.spriteRenderer = spriteRenderer;\n    spriteRenderer.curvature = .5;\n//    spriteRenderer.bigwave = 15;\n\n\n\n    //    var mouse = {x:0,y:0};\n    /*    document.addEventListener(\"mousemove\", function(e) {\n     mouse.x = e.pageX - innerWidth/2;\n     mouse.y = e.pageY - innerHeight/2;\n     e.preventDefault();\n     });\n     */\n\n    var range = 50;\n    var cellSize = 256;\n    engine.renderer.setClearColor (0x87CEEB, 1);\n\n\n\n\n    var roundabout = new DOK.Utils.Roundabout();\n    var closestPoint = { x:0,y:0};\n    function getClosestSpritePosition(x,y,limit) {\n        x = Math.round(x);\n        y = Math.round(y);\n        roundabout.reset();\n        //        console.log(x,y);\n\n        for(var i=0; i<limit; i++) {\n            var pos = roundabout.next();\n            var sprites = spriteCollection.get(x+pos[0],y+pos[1]);\n            if(sprites && !empty(sprites)) {\n                closestPoint.x = x+pos[0];\n                closestPoint.y = y+pos[1];\n                return closestPoint;\n            }\n        }\n        return null;\n    }\n\n    function empty(obj) {\n        for(var i in obj) {\n            return false;\n        }\n        return true;\n    }\n\n    function picked(obj) {\n        return obj.uid === pickedItem;\n    }\n\n\n    var mouseControl = false;\n    var selectedObj = { x: 0, y: 0};\n    function getSelected() {\n        if(!mouseControl) {\n            return null;\n        }\n        //        var xPos = camera.position.x + mouse.x * 2;\n        //        var yPos = camera.position.y - 2 * mouse.y;\n\n        var xPos = mousePos.x;\n        var yPos = mousePos.y;\n        if(selectedObj.x !== Math.round(xPos/cellSize) || selectedObj.y !== Math.round(yPos/cellSize)) {\n            selectedObj.x = Math.round(xPos/cellSize);\n            selectedObj.y = Math.round(yPos/cellSize);// + 6;\n        }\n        return selectedObj;\n    }\n\n    function getCamPos() {\n        var xPos = camera.position.x;\n        var yPos = camera.position.y;\n\n        selectedObj.x = Math.round(xPos/cellSize);\n        selectedObj.y = Math.round(yPos/cellSize) + 6;\n        return selectedObj;\n    }\n\n    var collection = new DOK.Collection(\n        {\n            type: \"grid\",\n            get x() {\n                return getCamPos().x -Math.floor(range/2);\n            },\n            get y() {\n                return getCamPos().y -Math.floor(range/2);\n            },\n            width: range,\n            height: range,\n        },\n        function(x,y) {\n            var frame = Math.floor(DOK.Loop.time/100);\n            var sel = getSelected();\n            var selected = sel && !spritePos && pickedItem===null && sel.x === x && sel.y === y;\n            var light = .5;\n            //var mapindex = x + y*10000;\n            var anim = DOK.SpriteSheet.spritesheet.sand;\n  //          if(shitMap[mapindex%shitMap.length]) {\n//                anim = DOK.SpriteSheet.spritesheet.dirt;\n    //        }\n\n            var img = anim[Math.abs(x*13^y*7)%4];\n            if(selected && Math.floor(DOK.Loop.time/10)%4!==0) {\n                img = getBorderedImage(img);\n            }\n\n            return DOK.SpriteObject.create(\n                x*cellSize,y*cellSize,0,//c!==0?0:-64,\n                cellSize,cellSize,\n                DOK.Camera.quaternions.southQuaternionArray,\n                img,\n                light*1.5,//c!==0?1:1.5,\n                0,//15,\n            );\n        }\n    );\n\n    function spriteSelection() {\n        var sel = spritePos;\n        return sel ? spriteCollection.get(sel.x,sel.y) : null;\n    }\n\n    var spriteCubes = [];\n    function spriteCube(spriteInfo) {\n        var x = spriteInfo.x;\n        var y = spriteInfo.y;\n        var index = spriteInfo.index;\n        var size = this.options.cellSize*3;\n        var pickedMe = picked(spriteInfo);\n        var light = pickedMe ? Math.random() : 1;\n        //spritePos && Math.floor(x)===spritePos.x&& Math.floor(y)===spritePos.y ? Math.random() : 1;\n        var selected = spritePos && Math.floor(x)===spritePos.x&& Math.floor(y)===spritePos.y;\n        var img = DOK.SpriteSheet.spritesheet.sprite[index];\n        if(!pickedMe && selected && Math.floor(DOK.Loop.time/10)%4!==0) {\n            img = getBorderedImage(img);\n        }\n\n        spriteCubes.push(DOK.SpriteObject.create(\n            x*cellSize,y*cellSize,size/2,\n            size,size,\n            DOK.Camera.quaternions.southQuaternionArray,\n            img,\n            light,\n            15,\n        ));\n        spriteCubes.push(DOK.SpriteObject.create(\n            x*cellSize-10,y*cellSize,size/2,\n            size,size,\n            DOK.Camera.quaternions.westQuaternionArray,\n            img,\n            light,\n            15,\n        ));\n        spriteCubes.push(DOK.SpriteObject.create(\n            x*cellSize+10,y*cellSize,size/2,\n            size,size,\n            DOK.Camera.quaternions.eastQuaternionArray,\n            img,\n            light,\n            15,\n        ));\n        spriteCubes.push(DOK.SpriteObject.create(\n            x*cellSize,y*cellSize,size/2,\n            size,size,\n            DOK.Camera.quaternions.eastQuaternionArray,\n            img,\n            light,\n            15,\n        ));\n        spriteCubes.forEach(setTypeCube)\n        return spriteCubes;\n    }\n\n    function setTypeCube(spriteObj) {\n        spriteObj.type = 'face';\n    }\n\n    function spriteFace(spriteInfo) {\n        var x = spriteInfo.x;\n        var y = spriteInfo.y;\n        var index = spriteInfo.index;\n        var size = this.options.cellSize*3;\n        var pickedMe = picked(spriteInfo);\n        var light = pickedMe ? Math.random() : 1;\n        //spritePos && Math.floor(x)===spritePos.x&& Math.floor(y)===spritePos.y ? Math.random() : 1;\n        var selected = spritePos && Math.floor(x)===spritePos.x&& Math.floor(y)===spritePos.y;\n        var img = DOK.SpriteSheet.spritesheet.sprite[index];\n        if(!pickedMe && selected && Math.floor(DOK.Loop.time/10)%4!==0) {\n            img = getBorderedImage(img);\n        }\n\n        var spriteObj = DOK.SpriteObject.create(\n            x*cellSize,y*cellSize,size/2,\n            size,size,\n            null,\n            img,\n            light,\n            15,\n        );\n        spriteObj.type = \"face\";\n        return spriteObj;\n    }\n\n\n    var spriteCollection = DOK.Collection.createSpriteCollection({\n        cellSize: cellSize,\n        spriteFunction: function(spriteInfo) {\n            switch (spriteInfo.type) {\n                case 'face':\n                    return spriteFace.call(this,spriteInfo);\n                    break;\n                case 'cube':\n                    return spriteCube.call(this,spriteInfo);\n                    break;\n            }\n        },\n    });\n    window.ss = spriteCollection;\n\n    var camera = DOK.Camera.getCamera();\n    //    var mz = 0, rot = 0;\n    var camGoal = {\n        x:camera.position.x, y:camera.position.y,\n    };\n\n    var mousePos = new THREE.Vector3();\n    /*    document.addEventListener(\"mousemove\", function(event) {\n     mouseMoveTo(event.pageX, event.pageY);\n     event.preventDefault();\n     });\n     */\n    var pickedItem = null;\n    /*    document.addEventListener(\"mousedown\", function(event) {\n     for(var uid in spriteSelection()) {\n     pickedItem = uid;\n     }\n     });\n\n     document.addEventListener(\"mouseup\", function(event) {\n     pickedItem = null;\n     });\n     */\n\n    /*\n     var geometry = new THREE.SphereGeometry(3, 50, 50, 0, Math.PI * 2, 0, Math.PI * 2);\n     var material = new THREE.MeshNormalMaterial();\n     var egg = new THREE.Mesh(geometry, material);\n     egg.position.set(0,0,0);\n     egg.geometry.scale(8,10,8);\n     scene.add(egg);\n     */\n\n/*    var request = new XMLHttpRequest();\n    request.open(\"GET\", \"config.json\", true);\n    request.addEventListener(\"load\", function() {\n        var config= JSON.parse(request.responseText);\n        DOK.Camera.setCameraPosition(config.camera);\n    });\n    request.send(null);\n*/\n\n    function createSprite(index) {\n        if(!getSelected()) {\n            return;\n        }\n        var x = getSelected().x; //getCamPos().x,\n        var y = getSelected().y; //getCamPos().y,\n        var spriteInfo = spriteCollection.create(x,y,index);\n        spriteInfo.type = 'face';\n        //        console.log(\"DROPPED\",spriteInfo);\n\n        /*        var geometry = new THREE.SphereGeometry(3, 50, 50, 0, Math.PI * 2, 0, Math.PI * 2);\n         var material = new THREE.MeshNormalMaterial();\n         var egg = new THREE.Mesh(geometry, material);\n         egg.position.set(getSelected().x*64,getSelected().y*64,0);\n         egg.geometry.scale(8,8,8);\n         scene.add(egg);*/\n        /*\n         var geometry = new THREE.PlaneGeometry(1,1);\n         var material = new THREE.MeshNormalMaterial();\n         var egg = new THREE.Mesh(geometry, material);\n         egg.position.set(getSelected().x*64,getSelected().y*64,0);\n         egg.geometry.scale(8,8,8);\n         egg.rotateX(Math.PI);\n         scene.add(egg);\n         */\n        /*\n         return DOK.create(DOK.SpriteObject).init(\n         x*cellSize,y*cellSize,size/2,\n         size,size,\n         null,\n         1,\n         DOK.spritesheet.sprite[index]\n         );\n         */\n    }\n\n    function cancel(e) {\n        e = e || event;\n        //console.log(e.dataTransfer);\n        //        mouse.x = e.pageX - innerWidth/2;\n        //        mouse.y = e.pageY - innerHeight/2;\n        mouseMoveTo(e.pageX, e.pageY);\n        e.preventDefault();\n        return false;\n    }\n\n    function drop(e) {\n        e = e || event;\n        var dt    = e.dataTransfer;\n        var reader = new FileReader();\n        var file = dt.files[0];\n        //        console.log(e);\n        reader.addEventListener( 'loadend', function(e) {\n            console.log(file.type);\n            if(['image/gif','image/jpeg','image/png'].indexOf(file.type)<0) {\n                return;\n            } else if(file.size>10000000) {\n                return;\n            }\n            var img = new Image();\n            img.addEventListener(\"load\", function(e) {\n                console.log(img);\n                //        images['floor'] = img.src;\n                const index = images.sprite.length;\n                images.sprite.push(img.src);\n                DOK.SpriteSheet.preLoad(images);\n\n                createSprite(index);\n\n\n                /*            document.getElementById(\"sidebar\").appendChild(img);\n                 img.style.cursor = \"pointer\";\n                 img.addEventListener(\"click\", function(e) {\n                 createSprite(index);\n\n                 });*/\n                //    img.addEventListener(\"click\", function(e) {\n                //\n                //  });\n                //        DOK.preLoad(images);\n                /*        hero[5] = mx - img.naturalWidth/2;\n                 hero[6] = my - img.naturalHeight/2;\n                 hero[7] = img.naturalWidth;\n                 hero[8] = img.naturalHeight;*/\n            });\n\n            img.src = this.result;\n            reader = null;\n        });\n\n        reader.readAsDataURL(file);\n        e.preventDefault();\n        return false;\n    }\n    document.addEventListener('dragover', cancel);\n    document.addEventListener('dragenter', cancel);\n    document.addEventListener('dragleave', cancel);\n    document.addEventListener('drop', drop);\n\n\n    /*\n     var geometry = new THREE.SphereGeometry(3, 50, 50, 0, Math.PI * 2, 0, Math.PI * 2);\n     var material = new THREE.MeshNormalMaterial();\n     var egg = new THREE.Mesh(geometry, material);\n     egg.position.set(0,0,0);\n     egg.geometry.scale(8,10,8);\n     scene.add(egg);\n     */\n\n\n    //    var raycaster = new THREE.Raycaster();\n    ///  var mouse = new THREE.Vector2();\n    var spritePos = null, mouseMoveToVector = new THREE.Vector3();\n    var mouseVector = new THREE.Vector3();\n    function mouseMoveTo(x,y) {\n        /*        mouse.x = x;\n         mouse.y = y;\n\n         var camera = DOK.getCamera();\n         raycaster.setFromCamera( mouse, camera );\n         var intersects = raycaster.intersectObjects( [spriteRenderer.mesh] );\n\n         if ( intersects.length > 0 ) {\n\n         var intersect = intersects[0];\n         console.log(intersect);\n         egg.position.x = intersect.point.x;\n         egg.position.y = intersect.point.y;\n         egg.position.z = intersect.point.z;\n         }*/\n\n        /*\n         // Parse all the faces\n         for ( var i in intersects ) {\n\n         intersects[ i ].face.material[ 0 ].color.setHex( Math.random() * 0xffffff | 0x80000000 );\n\n         }\n         */\n\n        mouseMoveToVector.set(\n            ( x / window.innerWidth ) * 2 - 1,\n            - ( y / window.innerHeight ) * 2 + 1,\n            0.5 );\n\n        mouseMoveToVector.unproject( camera );\n\n        var dir = mouseMoveToVector.sub( camera.position ).normalize();\n\n        var distance = - camera.position.z / dir.z;\n\n        mouseVector.copy(camera.position);\n        var pos = mouseVector.add( dir.multiplyScalar( distance ) );\n        mousePos.x = pos.x;\n        mousePos.y = pos.y;\n        mousePos.z = pos.z;\n\n\n        if(pickedItem) {\n            spritePos = null;\n            var sprite = spriteCollection.find(pickedItem);\n            sprite.move(pos.x/cellSize, pos.y/cellSize);\n            //            console.log(pickedItem);\n        } else {\n            var sel = getSelected();\n            if(sel) {\n                spritePos = getClosestSpritePosition(sel.x,sel.y,20);\n            }\n//            console.log(spritePos);\n        }\n        //        console.log(spritePos);\n    }\n\n\n\n    DOK.SpriteRenderer.setIndexProcessor(function (images, count) {\n        for(let i=0; i<images.length;i++) {\n            const image = images[i];\n            image.zIndex += image.spriteObject.type===\"face\"\n                ?10000\n                :image.spriteObject.type===\"cube\"\n                    ?10000\n                    :0;\n        }\n    });\n\n\n\n    var zoombar = .4;\n    var zoomState = [\n        { distance: 200, angle: 1.3 },\n        { distance: 1000, angle: .8 },\n    ];\n\n    function setMouseControl() {\n        mouseControl = true;\n\n        DOK.Mouse.setOnWheel(\n            function(dx,dy) {\n                zoombar = Math.max(0,Math.min(1,zoombar - dy/300));\n            }\n        );\n\n        DOK.Mouse.setOnZoom(\n            function(pinchSize) {\n                zoombar = Math.max(0,Math.min(1,zoombar + pinchSize/200));\n            }\n        );\n        DOK.Mouse.setOnTouch(\n            function(dx,dy,down,pageX,pageY) {\n                if(dx!==null && dy!==null) {\n                    if(pickedItem!==null) {\n                        mouseMoveTo(pageX, pageY);\n                    } else if(down) {\n                        camGoal.x = camera.position.x - dx*20;\n                        camGoal.y = camera.position.y + dy*20;\n                    } else {\n                        mouseMoveTo(pageX, pageY);\n                    }\n                    //            mz -= dy/2;\n                    //            rot += (dx/1000);\n                } else {\n                    if(down) {\n                        camGoal.x = camera.position.x;\n                        camGoal.y = camera.position.y;\n                        var sel = spriteSelection();\n                        if(sel) {\n                            for(var i=0; i<sel.length; i++ ) {\n                                pickedItem = sel[i].uid;\n                                break;\n                            }\n                        }\n                    } else {\n                        pickedItem = null;\n                    }\n                }\n            }\n        );\n    }\n\n\n    function updateCamera() {\n        var camera = DOK.Camera.getCamera();\n        camera.position.x += (camGoal.x - camera.position.x) / 3;\n        camera.position.y += (camGoal.y - camera.position.y) / 3;\n        camera.position.z = zoombar*zoomState[0].distance + (1-zoombar)*zoomState[1].distance;\n        camera.rotation.x = zoombar*zoomState[0].angle + (1-zoombar)*zoomState[1].angle;\n    }\n\n    const hero = {x:0,y:0,z:10,type:'hero',speed:.5,\n        last: 0,\n    };\n    var coin = 0;\n\n    var startTime = 0;\n    function showCoin() {\n/*        var time = (40-(DOK.Loop.time-startTime)/1000);\n        document.getElementById('sidebar').innerHTML =\n            \"$\"+coin + \"<br><font color='snow'>\" + Math.floor(time*100)/100 + \"</font>\";\n        if(time<0) {\n            alert(\"You made \"+\" $\"+coin+\" out of poop!\\n\\nPress [Ok] to replay\");\n            location.reload();\n        }*/\n    }\n\n\n//    var shitMap = new Array(100000);\n\n\n    var lastTime = 0;\n    DOK.Loop.addLoop(function() {\n        if(!window.gameStarted) {\n            return;\n        }\n\n\n        if(Date.now() - lastTime > 10) {\n            addSquid(hero);\n            addRunner(hero);\n            lastTime = Date.now();\n        }\n\n        const mov = DOK.Keyboard.getMove();\n        if(mov.x || mov.y) {\n            const dist = Math.sqrt(mov.x*mov.x + mov.y*mov.y);\n            hero.x += mov.x/dist * hero.speed;\n            hero.y += mov.y/dist * hero.speed;\n        }\n        camGoal.x += (hero.x*cellSize - camGoal.x)/5;\n        camGoal.y += (hero.y*cellSize - 2000 - camGoal.y)/5;\n\n        for(var i=0;i<actorsList.length;i++) {\n            var actor = actorsList[i];\n            if(!actor) {\n                continue;\n            }\n\n            if(actor.type !=='hero' && !actor.touched) {\n                if(actor.type==='squid') {\n                    actor.x += actor.dx;\n                    actor.y += actor.dy;\n                    actor.z += actor.dz;\n                    actor.dz-=.05;\n                    if(actor.z <0) {\n                        actor.z = 0;\n                        actor.dz = -actor.dz * .5;\n                        actor.dx += (Math.random() - .5) / 100;\n                        actor.dy += (Math.random() - .5) / 100;\n\n//                    var mapindex = Math.abs(Math.round(actor.x/cellSize) + Math.round(actor.y/cellSize) * 10000);\n                        //                  shitMap[mapindex % shitMap.length] = true;\n\n\n                        var runner = runners[Math.floor(Math.random()*runners.length)];\n                        var dx = runner.x - actor.x;\n                        var dy = runner.y - actor.y;\n                        const dist = Math.sqrt(dx*dx+dy*dy);\n                        if(dist < 1 && !runner.touched) {\n                            runner.touched = true;\n                            var pok = new Audio(\"splash.mp3\");\n                            pok.play();\n                        }\n                     }\n\n                } else {\n                    actor.x +=.1;\n                    actor.y += (Math.random()-.5) * .3;\n  //                  if(actor.x > hero.x + 50) {\n//                        actor.x = hero.x -10;\n    //                }\n                }\n/*                var dx = hero.x - actor.x;\n                var dy = hero.y - actor.y;\n                const dist = Math.sqrt(dx*dx+dy*dy);\n                if(dist<1) {\n                    actor.touched = true;\n                    var pok = new Audio(\"coin.ogg\");\n                    pok.play();\n                    addSquid();\n                    coin+=Math.ceil(1000*Math.random());\n                    showCoin();\n                } else if(dist<2 && !actor.touched && DOK.Loop.time- actor.burst>50) {\n                    actor.jump.x -= dx*(Math.random()-.3)*2;\n                    actor.jump.y -= dy*(Math.random()-.3)*2;\n                    actor.burst = DOK.Loop.time;\n                }\n\n                actor.x += (actor.jump.x-actor.x)/10;\n                actor.y += (actor.jump.y-actor.y)/10;*/\n            }\n        }\n    });\n\n\n\n    const squid = {x:-3,y:-3, type:'squid', touched:false, burst:0,\n        jump: {x:-3, y:-3},\n    };\n\n    var actorsList = [\n        hero,\n        squid,\n    ];\n\n    var index = 0;\n    function addSquid(hero) {\n//        var x = hero.x + (Math.random()-.5)*10;\n//        var y = hero.y + (Math.random()-.5)*10;\n        x = hero.x;\n        y = hero.y;\n        z = hero.z;\n        if(!actorsList[1+index%300]) {\n            const squid = {x:x,y:y,z:z, dx:0,dy:0,dz:0, type:'squid', touched:false, burst:0,\n                jump: {x:x, y:y, z:z}, index:Math.floor(Math.random()*10000)\n            };\n            actorsList[1+index%300] = (squid);\n        } else {\n            const squid = actorsList[1+index%300];\n            squid.x = x;\n            squid.y = y;\n            squid.z = z;\n            squid.dx = 0;\n            squid.dy = 0;\n            squid.dz = 0;\n            squid.touched = false;\n        }\n        index++;\n    }\n\n    var runners = [];\n    var index2 = 0;\n    function addRunner(hero) {\n        var x = hero.x + (Math.random()-.5)*10 -20;\n        var y = hero.y + (Math.random()-.5)*10;\n//        x = hero.x;\n  //      y = hero.y;\n //       z = hero.z;\n        z = 0;\n        if(!actorsList[301+index2%100]) {\n            const squid = {x:x,y:y,z:z, dx:0,dy:0,dz:0, type:'run', touched:false, burst:0,\n                jump: {x:x, y:y, z:z}, index:Math.floor(Math.random()*10000)\n            };\n            actorsList[301+index2%100] = (squid);\n            runners.push(squid);\n        } else {\n            if(!hero.touched) {\n                return;\n            }\n            const squid = actorsList[301+index2%100];\n            squid.x = x;\n            squid.y = y;\n            squid.z = z;\n            squid.dx = 0;\n            squid.dy = 0;\n            squid.dz = 0;\n            squid.touched = false;\n        }\n        index2++;\n\n    }\n\n\n    for(var i=0;i<100;i++) {\n//        addRunner(hero);\n//        addSquid();\n    }\n\n\n    var actors = new DOK.Collection(\n        {\n            array:[],\n        },\n        function(actor) {\n            if(!actor) {\n                return;\n            }\n            const mov = DOK.Keyboard.getMove();\n\n            var array = this.options.array;\n            array.length = 0;\n            var light = .7;\n            var wave = 0;\n            var h = 0;\n            var scale = 1;\n            if(actor.type==='hero') {\n                h = actor.z * 50;\n                var img = mov.x < 0\n                    ? DOK.SpriteSheet.spritesheet.hand.left\n                    : mov.x > 0\n                        ? DOK.SpriteSheet.spritesheet.hand.right :\n                hero.last ? hero.last: DOK.SpriteSheet.spritesheet.hand.right;\n                hero.last = img;\n/*                        : mov.y < 0\n                            ? DOK.SpriteSheet.spritesheet.hand.down\n                            : DOK.SpriteSheet.spritesheet.hand.up\n*/\n            } else if(!actor.touched && actor.type ==='squid') {\n                scale = .3;\n                h = actor.z * 50;\n                var frame = Math.floor(actor.index+DOK.Loop.time/100);\n                var anim = DOK.SpriteSheet.spritesheet.poop;\n                img = anim[(frame)%anim.length];\n            } else if(!actor.touched && actor.type ==='run') {\n                scale = 2;\n//                scale = .6;\n                h = actor.z * 50;\n                var frame = Math.floor(actor.index+DOK.Loop.time/100);\n                var anim = DOK.SpriteSheet.spritesheet.run;\n                img = anim; //anim[(frame)%anim.length];\n           } else {\n                scale = 2;\n                img = DOK.SpriteSheet.spritesheet.coin;\n                wave = 15;\n            }\n\n            array[0] = DOK.SpriteObject.create(\n                actor.x*cellSize,actor.y*cellSize,h,//c!==0?0:-64,\n                cellSize*scale,cellSize*scale,\n                null,\n                img,\n                light,//c!==0?1:1.5,\n                wave//15,\n            );\n            array[0].type = 'face';\n\n            return array;\n        },\n        function(callback) {\n            for(var i=0; i<actorsList.length; i++) {\n                const obj = this.getSprite(actorsList[i]);\n                if(Array.isArray(obj)) {\n                    obj.forEach(callback);\n                } else {\n                    callback(obj);\n                }\n            }\n        }\n    );\n\n\n\n\n//    DOK.Loop.fps = 45;\n    var frame = 0;\n    DOK.Loop.addLoop(function() {\n        if(!engine.ready || !window.gameStarted) {\n            return;\n        }\n        if(!startTime) {\n            startTime = DOK.Loop.time;\n        }\n        updateCamera();\n        //egg.rotateX(.1);\n        frame++;\n        //            camera.position.x -= ddx;\n        //          camera.position.y += ddy;\n        //        ddx *= .7;\n        //      ddy *= .7;\n        /*            camera.position.z += mz;\n         camera.rotateY(rot);\n         mz *= .8;\n         rot *= .8;*/\n        collection.forEach(spriteRenderer.display);\n        spriteCollection.forEach(spriteRenderer.display);\n        actors.forEach(spriteRenderer.display);\n        spriteRenderer.updateGraphics();\n//        if(frame%10===0) {\n            showCoin();\n  //      }\n//            document.getElementById(\"fps\").textContent = DOK.Loop.fps + \" fps\";\n\n    });\n\n//    setMouseControl();\n\n});"]}